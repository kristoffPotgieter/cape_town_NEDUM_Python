<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>inputs.data &mdash; NEDUM-2D for CoCT  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> NEDUM-2D for CoCT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme_link.html">Introducing NEDUM-2D</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license_rst.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guidelines.html">User guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../use_case.html">Use case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../technical_doc.html">Technical documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input_tables.html">Input tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_bases.html">Data bases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_sets.html">Data sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../math_appendix.html">Math appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_ref.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install_help.html">Installation help</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NEDUM-2D for CoCT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>inputs.data</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for inputs.data</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Tue Oct 27 15:57:41 2020.</span>

<span class="sd">@author: Charlotte Liotta</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>

<span class="kn">import</span> <span class="nn">calibration.sub.compute_income</span> <span class="k">as</span> <span class="nn">calcmp</span>
<span class="kn">import</span> <span class="nn">equilibrium.functions_dynamic</span> <span class="k">as</span> <span class="nn">eqdyn</span>


<div class="viewcode-block" id="import_grid"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_grid">[docs]</a><span class="k">def</span> <span class="nf">import_grid</span><span class="p">(</span><span class="n">path_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import pixel coordinates and distances to center.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_data</span> <span class="o">+</span> <span class="s1">&#39;grid_NEDUM_Cape_Town_500.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">grid</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ID</span>
    <span class="c1"># Reduce dimensionality of data by 1,000</span>
    <span class="n">grid</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="o">/</span><span class="mi">1000</span>
    <span class="n">grid</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Y</span><span class="o">/</span><span class="mi">1000</span>
    <span class="c1"># Compute distance to grid center</span>
    <span class="n">x_center</span> <span class="o">=</span> <span class="o">-</span><span class="mf">53267.944572790904</span><span class="o">/</span><span class="mi">1000</span>
    <span class="n">y_center</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3754855.1309322729</span><span class="o">/</span><span class="mi">1000</span>
    <span class="n">grid</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">grid</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">+</span> <span class="p">((</span><span class="n">grid</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>

    <span class="k">return</span> <span class="n">grid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_center</span><span class="p">,</span> <span class="n">y_center</span><span class="p">])</span></div>


<div class="viewcode-block" id="import_amenities"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_amenities">[docs]</a><span class="k">def</span> <span class="nf">import_amenities</span><span class="p">(</span><span class="n">path_precalc_inp</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import amenity index for each pixel.&quot;&quot;&quot;</span>
    <span class="c1"># Follow calibration from Pfeiffer et al. (appendix C4)</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;load_precal_param&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">precalculated_amenities</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span>
            <span class="n">path_precalc_inp</span> <span class="o">+</span> <span class="s1">&#39;calibratedAmenities.mat&#39;</span><span class="p">)[</span><span class="s2">&quot;amenities&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;load_precal_param&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">precalculated_amenities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="n">path_precalc_inp</span> <span class="o">+</span> <span class="s1">&#39;calibratedAmenities.npy&#39;</span><span class="p">)</span>
    <span class="c1"># Normalize index by mean of values</span>
    <span class="n">amenities</span> <span class="o">=</span> <span class="p">(</span><span class="n">precalculated_amenities</span>
                 <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">precalculated_amenities</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">amenities</span></div>


<div class="viewcode-block" id="import_hypothesis_housing_type"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_hypothesis_housing_type">[docs]</a><span class="k">def</span> <span class="nf">import_hypothesis_housing_type</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Import dummies to select income classes into housing types.&quot;&quot;&quot;</span>
    <span class="n">income_class_by_housing_type</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="c1"># Select which income class can live in formal settlements</span>
    <span class="n">income_class_by_housing_type</span><span class="p">[</span><span class="s2">&quot;formal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="c1"># Select which income class can live in backyard settlements</span>
    <span class="n">income_class_by_housing_type</span><span class="p">[</span><span class="s2">&quot;backyard&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="c1"># Select which income class can live in informal settlements</span>
    <span class="n">income_class_by_housing_type</span><span class="p">[</span><span class="s2">&quot;settlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="c1"># Select which income class can live in informal settlements</span>
    <span class="n">income_class_by_housing_type</span><span class="p">[</span><span class="s2">&quot;subsidized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">income_class_by_housing_type</span></div>


<div class="viewcode-block" id="import_income_classes_data"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_income_classes_data">[docs]</a><span class="k">def</span> <span class="nf">import_income_classes_data</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">path_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import population and average income per income class in the model.&quot;&quot;&quot;</span>
    <span class="c1"># Import population distribution according to housing type and income class</span>
    <span class="c1"># Note that RDP is included in formal</span>
    <span class="c1"># TODO: is formal backyard lacking or just included in formal housing?</span>
    <span class="n">income_baseline</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_data</span> <span class="o">+</span> <span class="s1">&#39;Income_distribution_2011.csv&#39;</span><span class="p">)</span>

    <span class="c1"># Compute overall median income</span>
    <span class="n">mean_income</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">income_baseline</span><span class="o">.</span><span class="n">Households_nb</span> <span class="o">*</span> <span class="n">income_baseline</span><span class="o">.</span><span class="n">INC_med</span>
                         <span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">income_baseline</span><span class="o">.</span><span class="n">Households_nb</span><span class="p">)</span>

    <span class="c1"># Get income classes from data (12)</span>
    <span class="n">nb_of_hh_bracket</span> <span class="o">=</span> <span class="n">income_baseline</span><span class="o">.</span><span class="n">Households_nb</span>
    <span class="n">avg_income_bracket</span> <span class="o">=</span> <span class="n">income_baseline</span><span class="o">.</span><span class="n">INC_med</span>

    <span class="c1"># Initialize income classes in model (4)</span>
    <span class="n">average_income</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">])</span>
    <span class="n">households_per_income_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">])</span>
    <span class="n">households_per_income_in_formal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">])</span>
    <span class="n">households_per_income_in_backyard</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">])</span>
    <span class="n">households_per_income_in_informal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">])</span>

    <span class="c1"># Compute population and median income for each class in the model</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">]):</span>
        <span class="n">households_per_income_class</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">nb_of_hh_bracket</span><span class="p">[(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;income_distribution&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="c1"># Note that this is in fact an average over median incomes</span>
        <span class="n">average_income</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">avg_income_bracket</span><span class="p">[(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;income_distribution&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="o">*</span> <span class="n">nb_of_hh_bracket</span><span class="p">[</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;income_distribution&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">/</span> <span class="n">households_per_income_class</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="c1"># We do the same across housing types for validation</span>
        <span class="n">households_per_income_in_formal</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">income_baseline</span><span class="o">.</span><span class="n">formal</span><span class="p">[(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;income_distribution&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="n">households_per_income_in_backyard</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">income_baseline</span><span class="o">.</span><span class="n">informal_backyard</span><span class="p">[</span>
                <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;income_distribution&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="p">)</span>
        <span class="n">households_per_income_in_informal</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">income_baseline</span><span class="o">.</span><span class="n">informal_settlement</span><span class="p">[</span>
                <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;income_distribution&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="p">)</span>

    <span class="c1">#  Compute ratio of average income per class over global income average</span>
    <span class="n">income_mult</span> <span class="o">=</span> <span class="n">average_income</span> <span class="o">/</span> <span class="n">mean_income</span>

    <span class="c1"># Store breakdown in unique array</span>
    <span class="n">households_per_income_and_housing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
        <span class="p">[</span><span class="n">households_per_income_in_formal</span><span class="p">,</span> <span class="n">households_per_income_in_backyard</span><span class="p">,</span>
         <span class="n">households_per_income_in_informal</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">mean_income</span><span class="p">,</span> <span class="n">households_per_income_class</span><span class="p">,</span> <span class="n">average_income</span><span class="p">,</span>
            <span class="n">income_mult</span><span class="p">,</span> <span class="n">income_baseline</span><span class="p">,</span> <span class="n">households_per_income_and_housing</span><span class="p">)</span></div>


<div class="viewcode-block" id="import_households_data"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_households_data">[docs]</a><span class="k">def</span> <span class="nf">import_households_data</span><span class="p">(</span><span class="n">path_precalc_inp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import geographic data with class distributions for households.&quot;&quot;&quot;</span>
    <span class="c1"># Import a structure of characteristics (for pixels and SPs mostly)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">path_precalc_inp</span> <span class="o">+</span> <span class="s1">&#39;data.mat&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>

    <span class="c1">#  Get maximum thresholds for model income classes (4)</span>
    <span class="n">threshold_income_distribution</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
        <span class="s1">&#39;thresholdIncomeDistribution&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="c1"># Get data from RDP for pixels (24,014)</span>
    <span class="c1"># NB: this is obtained from cadastre data (pre-processed by Claus)</span>
    <span class="n">data_rdp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="c1">#  Number of RDP units</span>
    <span class="n">data_rdp</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gridCountRDPfromGV&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="c1">#  Surface of RDP units</span>
    <span class="n">data_rdp</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gridAreaRDPfromGV&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="c1"># Get other data for pixels</span>
    <span class="c1">#  Dummy indicating wheter pixel belongs to Mitchell&#39;s Plain district</span>
    <span class="n">mitchells_plain_grid_baseline</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;MitchellsPlain&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="c1">#  Population density in formal housing</span>
    <span class="n">grid_formal_density_HFA</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gridFormalDensityHFA&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="c1"># Get housing type data for SPs (1,046)</span>
    <span class="n">housing_types_sp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="c1">#  Number of backyard settlements</span>
    <span class="n">housing_types_sp</span><span class="p">[</span><span class="s2">&quot;backyard_SP_2011&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
        <span class="s1">&#39;spInformalBackyard&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="c1">#  Number of informal settlements</span>
    <span class="n">housing_types_sp</span><span class="p">[</span><span class="s2">&quot;informal_SP_2011&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
        <span class="s1">&#39;spInformalSettlement&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="c1">#  Number of dwellings</span>
    <span class="c1">#  TODO: check if this includes formal backyards</span>
    <span class="n">housing_types_sp</span><span class="p">[</span><span class="s2">&quot;total_dwellings_SP_2011&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
        <span class="s1">&#39;spTotalDwellings&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="c1">#  Coordinates</span>
    <span class="n">housing_types_sp</span><span class="p">[</span><span class="s2">&quot;x_sp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;spX&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">housing_types_sp</span><span class="p">[</span><span class="s2">&quot;y_sp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;spY&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="c1"># Get other data for SPs</span>
    <span class="n">data_sp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="c1">#  Avg dwelling size</span>
    <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;dwelling_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;spDwellingSize&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="c1">#  Avg price of real estate (per m^2) for 2011</span>
    <span class="c1">#  (we do not consider data for 2001 and 2006)</span>
    <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;spPrice&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
    <span class="c1">#  Other aggregate statistics</span>
    <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sp2011AverageIncome&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;unconstrained_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spUnconstrainedArea&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sp2011Area&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sp2011Distance&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="c1">#  Dummy indicating wheter SP belongs to Mitchell&#39;s Plain district</span>
    <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;mitchells_plain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sp2011MitchellsPlain&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="c1">#  SP codes</span>
    <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;sp_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spCode&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="c1"># Nb of househods of each model income class in each SP</span>
    <span class="n">income_distribution</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span>
        <span class="s2">&quot;sp2011IncomeDistributionNClass&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="c1"># Dummy indicating whether SP belongs to Cape Town</span>
    <span class="n">cape_town_limits</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sp2011CapeTown&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">data_rdp</span><span class="p">,</span> <span class="n">housing_types_sp</span><span class="p">,</span> <span class="n">data_sp</span><span class="p">,</span> <span class="n">mitchells_plain_grid_baseline</span><span class="p">,</span>
            <span class="n">grid_formal_density_HFA</span><span class="p">,</span> <span class="n">threshold_income_distribution</span><span class="p">,</span>
            <span class="n">income_distribution</span><span class="p">,</span> <span class="n">cape_town_limits</span><span class="p">)</span></div>


<div class="viewcode-block" id="import_macro_data"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_macro_data">[docs]</a><span class="k">def</span> <span class="nf">import_macro_data</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">path_scenarios</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import interest rate and population per housing type.&quot;&quot;&quot;</span>
    <span class="c1"># Interest rate</span>
    <span class="c1">#  Import interest_rate history + scenario until 2040</span>
    <span class="n">scenario_interest_rate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_scenarios</span> <span class="o">+</span> <span class="s1">&#39;Scenario_interest_rate_1.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
    <span class="c1">#  Fit linear regression spline centered around baseline year</span>
    <span class="n">spline_interest_rate</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">scenario_interest_rate</span><span class="o">.</span><span class="n">Year_interest_rate</span><span class="p">[</span>
            <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">scenario_interest_rate</span><span class="o">.</span><span class="n">real_interest_rate</span><span class="p">)]</span>
        <span class="o">-</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;baseline_year&quot;</span><span class="p">],</span>
        <span class="n">scenario_interest_rate</span><span class="o">.</span><span class="n">real_interest_rate</span><span class="p">[</span>
            <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">scenario_interest_rate</span><span class="o">.</span><span class="n">real_interest_rate</span><span class="p">)],</span>
        <span class="s1">&#39;linear&#39;</span>
        <span class="p">)</span>
    <span class="c1">#  Get interest rate as the mean (in %) over x last years</span>
    <span class="n">interest_rate</span> <span class="o">=</span> <span class="n">eqdyn</span><span class="o">.</span><span class="n">interpolate_interest_rate</span><span class="p">(</span><span class="n">spline_interest_rate</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Aggregate population: this come from SAL data and serves as a benchmark</span>
    <span class="c1"># to reweight aggregates obtained from diverse granular data sets so that</span>
    <span class="c1"># the same overall population is indeed considered</span>

    <span class="n">sal_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">path_folder</span>
        <span class="o">+</span> <span class="s2">&quot;CT Dwelling type data validation workbook 20201204 v2.xlsx&quot;</span><span class="p">,</span>
        <span class="n">header</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">5339</span><span class="p">)</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;informal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span>
        <span class="s2">&quot;Informal dwelling (shack; not in backyard; e.g. in an&quot;</span>
        <span class="o">+</span> <span class="s2">&quot; informal/squatter settlement or on a farm)&quot;</span><span class="p">]</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_formal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;House/flat/room in backyard&quot;</span><span class="p">]</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_informal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span>
        <span class="s2">&quot;Informal dwelling (shack; in backyard)&quot;</span><span class="p">]</span>
    <span class="c1"># NB: we do not include traditional houses, granny flats, caravans, and</span>
    <span class="c1"># others</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;formal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">sal_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">rdp_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">path_folder</span>
        <span class="o">+</span> <span class="s2">&quot;CT Dwelling type data validation workbook 20201204 v2.xlsx&quot;</span><span class="p">,</span>
        <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Analysis&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="s2">&quot;A:B&quot;</span><span class="p">,</span>
        <span class="n">skiprows</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">total_RDP</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rdp_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="c1"># Else, SR2 (incremental housing) properties according to 2012 General</span>
    <span class="c1"># Valuation yield 138,444 properties. By adding approximately 40,000</span>
    <span class="c1"># council housing units (similar to RDP/BNG in use), we get a &quot;close&quot;</span>
    <span class="c1"># estimate:</span>
    <span class="c1"># total_RDP = 138444 + 40000</span>
    <span class="n">total_formal</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;formal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">total_RDP</span>
    <span class="n">total_informal</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;informal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">total_backyard</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_informal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="c1"># Note that we only include informal backyards  by assumption in the model:</span>
    <span class="c1"># we are sure that formal backyards are note included in formal count here</span>

    <span class="c1"># Old raw figures from Claus</span>
    <span class="c1"># total_RDP = 194258</span>
    <span class="c1"># total_formal = 626770</span>
    <span class="c1"># total_informal = 143765</span>
    <span class="c1"># total_backyard = 91132</span>

    <span class="n">housing_type_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">total_formal</span><span class="p">,</span> <span class="n">total_backyard</span><span class="p">,</span> <span class="n">total_informal</span><span class="p">,</span>
                                  <span class="n">total_RDP</span><span class="p">])</span>
    <span class="n">population</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">housing_type_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">interest_rate</span><span class="p">,</span> <span class="n">population</span><span class="p">,</span> <span class="n">housing_type_data</span><span class="p">,</span> <span class="n">total_RDP</span></div>


<div class="viewcode-block" id="import_land_use"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_land_use">[docs]</a><span class="k">def</span> <span class="nf">import_land_use</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">data_rdp</span><span class="p">,</span> <span class="n">housing_types</span><span class="p">,</span>
                    <span class="n">housing_type_data</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return linear regression spline estimates for housing building paths.&quot;&quot;&quot;</span>
<span class="c1"># 0. Import data</span>

    <span class="c1"># Social housing</span>

    <span class="c1"># New RDP construction projects</span>
    <span class="n">construction_rdp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_data</span> <span class="o">+</span> <span class="s1">&#39;grid_new_RDP_projects.csv&#39;</span><span class="p">)</span>

    <span class="c1"># RDP population data</span>
    <span class="c1">#  We take total population in RDP at baseline year</span>
    <span class="n">RDP_baseline</span> <span class="o">=</span> <span class="n">housing_type_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="c1">#  Also comes from general validation for 2001</span>
    <span class="c1">#  TODO: ask Claus for references</span>
    <span class="n">RDP_restrospect</span> <span class="o">=</span> <span class="mf">1.1718e+05</span>

    <span class="c1"># Land cover for informal settlements (see R code for details)</span>

    <span class="c1"># Set the area of a pixel in mÂ²</span>
    <span class="n">area_pixel</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000000</span>

    <span class="c1"># General surface data on land use (urban, agricultural...)</span>
    <span class="n">land_use_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_data</span> <span class="o">+</span> <span class="s1">&#39;grid_NEDUM_Cape_Town_500.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

    <span class="c1"># Surface data on scenarios for informal settlement building</span>
    <span class="n">informal_risks_short</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_SHORT.csv&#39;</span><span class="p">,</span>
        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">informal_risks_long</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_LONG.csv&#39;</span><span class="p">,</span>
        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">informal_risks_medium</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_MEDIUM.csv&#39;</span><span class="p">,</span>
        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">informal_risks_HIGH</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_pHIGH.csv&#39;</span><span class="p">,</span>
        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">informal_risks_VERYHIGH</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_folder</span>
        <span class="o">+</span> <span class="s1">&#39;Land occupation/informal_settlements_risk_pVERYHIGH.csv&#39;</span><span class="p">,</span>
        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

    <span class="c1"># Nb of informal dwellings per pixel</span>
    <span class="n">informal_settlements_nearfuture</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Flood plains - from Claus/inf_dwellings_2020.xlsx&#39;</span><span class="p">)</span>
    <span class="c1"># Here we correct by 1 / max_land_use to make it comparable with other</span>
    <span class="c1"># informal risks (this will be removed afterwards as it does not</span>
    <span class="c1"># correspond to reality)</span>
    <span class="n">informal_risks_nearfuture</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">informal_settlements_nearfuture</span><span class="o">.</span><span class="n">inf_dwellings_2020</span>
        <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;shack_size&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;max_land_use_settlement&quot;</span><span class="p">]))</span>
    <span class="c1"># We neglect building risks smaller than 1% of a pixel area</span>
    <span class="n">informal_risks_nearfuture</span><span class="p">[</span><span class="n">informal_risks_nearfuture</span> <span class="o">&lt;</span> <span class="n">area_pixel</span><span class="o">/</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">informal_risks_nearfuture</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">informal_risks_nearfuture</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Pixel selection for scenario correction</span>

    <span class="c1"># We want to include pushback from farmers around Philipi, hence we delay</span>
    <span class="c1"># settlement of those areas compared to other short-term risks</span>
    <span class="n">polygon_medium_timing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;Land occupation/polygon_medium_timing.xlsx&#39;</span><span class="p">,</span>
        <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># We take the selected pixels from medium scenario and make their risk</span>
    <span class="c1"># area equal to the short scenario, then take the same selection in the</span>
    <span class="c1"># short scenario and make their risk area equal to zero</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">polygon_medium_timing</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()):</span>
        <span class="n">informal_risks_medium</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">informal_risks_medium</span><span class="p">[</span><span class="s2">&quot;grid.data.ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">item</span><span class="p">,</span>
            <span class="s2">&quot;area&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">informal_risks_short</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">informal_risks_short</span><span class="p">[</span><span class="s2">&quot;grid.data.ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">item</span><span class="p">,</span>
                <span class="s2">&quot;area&quot;</span>
                <span class="p">]</span>
        <span class="n">informal_risks_short</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">informal_risks_short</span><span class="p">[</span><span class="s2">&quot;grid.data.ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">item</span><span class="p">,</span>
            <span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>


<span class="c1"># 1. Total RDP population</span>

    <span class="c1"># We compute linear regression spline for 4 years centered around baseline</span>
    <span class="c1"># Construction rate comes from working paper&#39;s median scenario, then a</span>
    <span class="c1"># lower rate after the end of the programme in 2020</span>
    <span class="n">spline_RDP</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">2001</span> <span class="o">-</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;baseline_year&quot;</span><span class="p">],</span> <span class="mi">2011</span> <span class="o">-</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;baseline_year&quot;</span><span class="p">],</span>
         <span class="mi">2020</span> <span class="o">-</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;baseline_year&quot;</span><span class="p">],</span> <span class="mi">2041</span> <span class="o">-</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;baseline_year&quot;</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">RDP_restrospect</span><span class="p">,</span> <span class="n">RDP_baseline</span><span class="p">,</span> <span class="n">RDP_baseline</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="mi">5000</span><span class="p">,</span>
         <span class="n">RDP_baseline</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="mi">5000</span> <span class="o">+</span> <span class="mi">21</span> <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;future_rate_public_housing&quot;</span><span class="p">]],</span>
        <span class="s1">&#39;linear&#39;</span>
        <span class="p">)</span>

    <span class="c1"># We capture the output of the function to be used later on</span>
    <span class="c1">#  Start of the programme</span>
    <span class="n">year_begin_RDP</span> <span class="o">=</span> <span class="mi">2015</span>
    <span class="c1">#  We &quot;center&quot; scenarios around baseline year</span>
    <span class="n">year_RDP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">year_begin_RDP</span><span class="p">,</span> <span class="mi">2040</span><span class="p">)</span> <span class="o">-</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;baseline_year&quot;</span><span class="p">]</span>
    <span class="c1">#  We take the spline output for this timeline</span>
    <span class="n">number_RDP</span> <span class="o">=</span> <span class="n">spline_RDP</span><span class="p">(</span><span class="n">year_RDP</span><span class="p">)</span>


<span class="c1"># 2. RDP nb of houses</span>

    <span class="c1"># Setting the timeline</span>

    <span class="c1">#  We take the absolute difference between projected and actual RDP</span>
    <span class="c1">#  constructions over the years (RDP left to build) and return the year</span>
    <span class="c1">#  index for the minimum: this define the short-term horizon of the pgrm</span>
    <span class="n">year_short_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_ST</span><span class="p">)</span>
               <span class="o">-</span> <span class="p">(</span><span class="n">number_RDP</span> <span class="o">-</span> <span class="n">number_RDP</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="p">)</span>
    <span class="c1">#  We just take size of the projection array for long-term horizon</span>
    <span class="n">year_long_term</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="c1">#  We save the timeline into a list</span>
    <span class="n">year_data_informal</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">2000</span> <span class="o">-</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;baseline_year&quot;</span><span class="p">],</span>
        <span class="n">year_begin_RDP</span> <span class="o">-</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;baseline_year&quot;</span><span class="p">],</span>
        <span class="n">year_short_term</span><span class="p">,</span>
        <span class="n">year_long_term</span>
        <span class="p">]</span>

    <span class="c1"># Getting the outcome</span>

    <span class="c1">#  We weight by closeness to the center to get retrospective number of RDP</span>
    <span class="c1">#  in 2000 (by assuming that central areas where built before)</span>
    <span class="n">number_properties_retrospect</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">data_rdp</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
        <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">grid</span><span class="o">.</span><span class="n">dist</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">dist</span><span class="p">[</span><span class="n">data_rdp</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="p">)</span>
    <span class="c1">#  Actual nb of RDP houses in 2011</span>
    <span class="n">RDP_houses_estimates</span> <span class="o">=</span> <span class="n">data_rdp</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>

    <span class="c1"># Regression spline</span>

    <span class="n">spline_estimate_RDP</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">year_data_informal</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
            <span class="p">[</span><span class="n">number_properties_retrospect</span><span class="p">,</span>
             <span class="n">RDP_houses_estimates</span><span class="p">,</span>
             <span class="n">RDP_houses_estimates</span> <span class="o">+</span> <span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_ST</span><span class="p">,</span>
             <span class="n">RDP_houses_estimates</span> <span class="o">+</span> <span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_ST</span>
             <span class="o">+</span> <span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_LT</span><span class="p">]</span>
            <span class="p">),</span>
        <span class="s1">&#39;linear&#39;</span><span class="p">)</span>

    <span class="n">number_properties_RDP</span> <span class="o">=</span> <span class="n">spline_estimate_RDP</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># 3. RDP pixel share</span>

    <span class="c1"># Getting areas: note that we divide by max_land_use as original data is</span>
    <span class="c1"># already corrected and we want to make the spline coherent with other</span>
    <span class="c1"># non-corrected housing types</span>

    <span class="c1">#  % of the pixel area dedicated to RDP (after accounting for backyards)</span>
    <span class="n">area_RDP</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_rdp</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;RDP_size&quot;</span><span class="p">]</span>
                <span class="o">/</span> <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;backyard_size&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;RDP_size&quot;</span><span class="p">])</span>
                <span class="o">/</span> <span class="n">area_pixel</span><span class="p">)</span> <span class="o">/</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;max_land_use&quot;</span><span class="p">]</span>

    <span class="c1">#  For the RDP constructed area, we take the min between declared value and</span>
    <span class="c1">#  extrapolation from our initial size parameters</span>

    <span class="c1">#  We do it for the short term</span>
    <span class="n">area_RDP_short_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span>
        <span class="n">construction_rdp</span><span class="o">.</span><span class="n">area_ST</span><span class="p">,</span>
        <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;backyard_size&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;RDP_size&quot;</span><span class="p">])</span>
        <span class="o">*</span> <span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_ST</span>
        <span class="p">)</span> <span class="o">/</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;max_land_use&quot;</span><span class="p">]</span>
    <span class="c1">#  Then for the long term, while capping the constructed area at the pixel</span>
    <span class="c1">#  size (just in case)</span>
    <span class="n">area_RDP_long_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span>
            <span class="n">construction_rdp</span><span class="o">.</span><span class="n">area_ST</span> <span class="o">+</span> <span class="n">construction_rdp</span><span class="o">.</span><span class="n">area_LT</span><span class="p">,</span>
            <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;backyard_size&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;RDP_size&quot;</span><span class="p">])</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_ST</span>
               <span class="o">+</span> <span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_LT</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="n">area_pixel</span>
        <span class="p">)</span> <span class="o">/</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;max_land_use&quot;</span><span class="p">]</span>

    <span class="c1"># Regression spline</span>

    <span class="n">spline_land_RDP</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">year_data_informal</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
            <span class="p">[</span><span class="n">area_RDP</span><span class="p">,</span> <span class="n">area_RDP</span><span class="p">,</span> <span class="n">area_RDP_short_term</span><span class="p">,</span> <span class="n">area_RDP_long_term</span><span class="p">]</span>
            <span class="p">),</span>
        <span class="s1">&#39;linear&#39;</span><span class="p">)</span>


<span class="c1"># 4. Backyarding pixel share</span>

    <span class="c1"># Getting areas</span>

    <span class="c1">#  We get share of pixel backyard area by reweighting total area by the</span>
    <span class="c1">#  share of backyards in social housing units</span>
    <span class="n">area_backyard</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_rdp</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;backyard_size&quot;</span><span class="p">]</span>
                     <span class="o">/</span> <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;backyard_size&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;RDP_size&quot;</span><span class="p">])</span>
                     <span class="o">/</span> <span class="n">area_pixel</span><span class="p">)</span>

    <span class="c1">#  Share of pixel urban land</span>
    <span class="n">urban</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">land_use_data</span><span class="o">.</span><span class="n">urban</span><span class="p">)</span> <span class="o">/</span> <span class="n">area_pixel</span>
    <span class="c1">#  We consider that the potential for backyard building cannot exceed that</span>
    <span class="c1">#  of urban area</span>
    <span class="n">coeff_land_backyard</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">urban</span><span class="p">,</span> <span class="n">area_backyard</span><span class="p">)</span>

    <span class="c1">#  We reweight max pixel share available for backyarding (both formal and</span>
    <span class="c1">#  informal) by a ratio of how densely populated the pixel is: this yields</span>
    <span class="c1">#  an alternative definition of coeff_land_backyard that includes formal</span>
    <span class="c1">#  backyarding and may be used for flood damage estimations</span>

    <span class="c1">#  NB: note that the pb with previous specification is not that we do not</span>
    <span class="c1">#  take formal backyards into account, but rather that we abstract from</span>
    <span class="c1">#  backyarding occurring within formal private houses</span>

    <span class="n">actual_backyards</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">housing_types</span><span class="o">.</span><span class="n">backyard_formal_grid</span>
         <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">backyard_informal_grid</span><span class="p">)</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">housing_types</span><span class="o">.</span><span class="n">backyard_formal_grid</span>
                    <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">backyard_informal_grid</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coeff_land_backyard</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;actual_backyards&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">actual_backyards</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#  To project backyard share of pixel area on the ST, we add the potential</span>
    <span class="c1">#  backyard construction from RDP projects</span>
    <span class="n">area_backyard_short_term</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">area_backyard</span>
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span>
            <span class="n">area_RDP_short_term</span>
            <span class="o">-</span> <span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_ST</span> <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;RDP_size&quot;</span><span class="p">],</span>
            <span class="mi">0</span>
            <span class="p">)</span> <span class="o">/</span> <span class="n">area_pixel</span>
        <span class="p">)</span>

    <span class="c1">#  We do the same for RDP share of pixel area, by substracting backyarding</span>
    <span class="n">area_RDP_short_term</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">area_RDP</span>
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span>
            <span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_ST</span> <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;RDP_size&quot;</span><span class="p">],</span>
            <span class="n">construction_rdp</span><span class="o">.</span><span class="n">area_ST</span>
            <span class="p">)</span> <span class="o">/</span> <span class="n">area_pixel</span>
        <span class="p">)</span>

    <span class="c1">#  We make sure that pixel share of backyard area does not exceed max</span>
    <span class="c1">#  available land after RDP construction</span>
    <span class="n">area_backyard_short_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span>
        <span class="n">area_backyard_short_term</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;max_land_use&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">area_RDP_short_term</span>
        <span class="p">)</span>

    <span class="c1">#  We repeat the process for backyarding over the LT</span>
    <span class="n">area_backyard_long_term</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">area_backyard</span>
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span>
            <span class="n">area_RDP_long_term</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_LT</span>
               <span class="o">+</span> <span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_ST</span><span class="p">)</span> <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;RDP_size&quot;</span><span class="p">],</span>
            <span class="mi">0</span>
            <span class="p">)</span> <span class="o">/</span> <span class="n">area_pixel</span>
        <span class="p">)</span>

    <span class="n">area_RDP_long_term</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">area_RDP</span>
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span>
            <span class="p">(</span><span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_LT</span>
             <span class="o">+</span> <span class="n">construction_rdp</span><span class="o">.</span><span class="n">total_yield_DU_ST</span><span class="p">)</span> <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;RDP_size&quot;</span><span class="p">],</span>
            <span class="n">area_RDP_long_term</span>
            <span class="p">)</span> <span class="o">/</span> <span class="n">area_pixel</span>
        <span class="p">)</span>

    <span class="n">area_backyard_long_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span>
        <span class="n">area_backyard_long_term</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;max_land_use&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">area_RDP_long_term</span>
        <span class="p">)</span>

    <span class="c1"># Regression spline</span>

    <span class="n">spline_land_backyard</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="n">year_data_informal</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">area_backyard</span><span class="p">,</span> <span class="n">actual_backyards</span><span class="p">),</span>
             <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">area_backyard</span><span class="p">,</span> <span class="n">actual_backyards</span><span class="p">),</span>
             <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">area_backyard_short_term</span><span class="p">,</span> <span class="n">actual_backyards</span><span class="p">),</span>
             <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">area_backyard_long_term</span><span class="p">,</span> <span class="n">actual_backyards</span><span class="p">)]</span>
            <span class="p">),</span>
        <span class="s1">&#39;linear&#39;</span><span class="p">)</span>


<span class="c1"># 5. Unconstrained land pixel share</span>

    <span class="c1"># We get pixel share with and without urban edge</span>
    <span class="n">coeff_land_no_urban_edge</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">land_use_data</span><span class="o">.</span><span class="n">unconstrained_out</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">land_use_data</span><span class="o">.</span><span class="n">unconstrained_UE</span><span class="p">))</span> <span class="o">/</span> <span class="n">area_pixel</span>
    <span class="n">coeff_land_urban_edge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
        <span class="n">land_use_data</span><span class="o">.</span><span class="n">unconstrained_UE</span><span class="p">)</span> <span class="o">/</span> <span class="n">area_pixel</span>

    <span class="c1"># Regression spline (with or without urban edge)</span>

    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;urban_edge&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">year_constraints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">1990</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;year_urban_edge&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;year_urban_edge&quot;</span><span class="p">],</span>
             <span class="mi">2040</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">-</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;baseline_year&quot;</span><span class="p">]</span>
        <span class="n">spline_land_constraints</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">year_constraints</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">coeff_land_urban_edge</span><span class="p">,</span> <span class="n">coeff_land_urban_edge</span><span class="p">,</span>
                     <span class="n">coeff_land_no_urban_edge</span><span class="p">,</span> <span class="n">coeff_land_no_urban_edge</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">),</span> <span class="s1">&#39;linear&#39;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">year_constraints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1990</span><span class="p">,</span> <span class="mi">2040</span><span class="p">])</span> <span class="o">-</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;baseline_year&quot;</span><span class="p">]</span>
        <span class="n">spline_land_constraints</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">year_constraints</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">coeff_land_urban_edge</span><span class="p">,</span> <span class="n">coeff_land_urban_edge</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="p">)</span>


<span class="c1"># 6. Informal settlement pixel share</span>

    <span class="c1"># Getting areas</span>

    <span class="c1">#  We get pixel share for informal settlement area at baseline</span>
    <span class="n">informal_baseline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">land_use_data</span><span class="o">.</span><span class="n">informal</span><span class="p">)</span> <span class="o">/</span> <span class="n">area_pixel</span>

    <span class="c1">#  We consider construction risk as the higher bound between initial</span>
    <span class="c1">#  conditions and prospective scenario</span>
    <span class="n">informal_nearfuture</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">informal_risks_nearfuture</span> <span class="o">/</span> <span class="n">area_pixel</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">)</span>

    <span class="c1">#  We also get area for high risk scenario retained in projections</span>
    <span class="c1">#  TODO: add option to take into account less likely developments?</span>
    <span class="n">high_proba</span> <span class="o">=</span> <span class="n">informal_risks_VERYHIGH</span><span class="o">.</span><span class="n">area</span> <span class="o">+</span> <span class="n">informal_risks_HIGH</span><span class="o">.</span><span class="n">area</span>

    <span class="c1">#  We consider some scenario for 2023 and correct for RDP construction</span>
    <span class="c1">#  (as informal predictions are not precise enough to account for such</span>
    <span class="c1">#  unavailable area)</span>
    <span class="n">informal_midshort_fut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span>
        <span class="n">coeff_land_no_urban_edge</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span>
            <span class="n">informal_nearfuture</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">informal_risks_short</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">high_proba</span><span class="p">))</span>
            <span class="o">/</span> <span class="n">area_pixel</span>
            <span class="p">)</span>
        <span class="p">)</span> <span class="o">-</span> <span class="n">spline_land_RDP</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">informal_midshort_fut</span><span class="p">[</span><span class="n">informal_midshort_fut</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#  We do the same for 2025</span>
    <span class="n">informal_midlong_fut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span>
        <span class="n">coeff_land_no_urban_edge</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span>
            <span class="n">informal_midshort_fut</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">informal_risks_medium</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">high_proba</span><span class="p">))</span>
            <span class="o">/</span> <span class="n">area_pixel</span>
            <span class="p">)</span>
        <span class="p">)</span> <span class="o">-</span> <span class="n">spline_land_RDP</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">informal_midlong_fut</span><span class="p">[</span><span class="n">informal_midlong_fut</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#  And again for 2030</span>
    <span class="n">informal_long_fut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span>
        <span class="n">coeff_land_no_urban_edge</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span>
            <span class="n">informal_midlong_fut</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">informal_risks_long</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">high_proba</span><span class="p">))</span>
            <span class="o">/</span> <span class="n">area_pixel</span>
            <span class="p">)</span>
        <span class="p">)</span> <span class="o">-</span> <span class="n">spline_land_RDP</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
    <span class="n">informal_long_fut</span><span class="p">[</span><span class="n">informal_long_fut</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Regression spline (with land constraints)</span>

    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;informal_land_constrained&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">spline_land_informal</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">29</span><span class="p">],</span>
            <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                <span class="p">[</span><span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span>
                 <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span>
                 <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_nearfuture</span><span class="p">,</span> <span class="n">informal_midshort_fut</span><span class="p">,</span> <span class="n">informal_midlong_fut</span><span class="p">,</span>
                 <span class="n">informal_long_fut</span><span class="p">,</span> <span class="n">informal_long_fut</span><span class="p">]</span>
                <span class="p">),</span>
            <span class="s1">&#39;linear&#39;</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;informal_land_constrained&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">spline_land_informal</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">29</span><span class="p">],</span>
            <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                <span class="p">[</span><span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span>
                 <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_baseline</span><span class="p">,</span>
                 <span class="n">informal_baseline</span><span class="p">,</span> <span class="n">informal_nearfuture</span><span class="p">,</span> <span class="n">informal_nearfuture</span><span class="p">,</span> <span class="n">informal_nearfuture</span><span class="p">,</span>
                 <span class="n">informal_nearfuture</span><span class="p">,</span> <span class="n">informal_nearfuture</span><span class="p">]</span>
                <span class="p">),</span>
            <span class="s1">&#39;linear&#39;</span>
            <span class="p">)</span>


<span class="c1"># 7. Function output</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">spline_RDP</span><span class="p">,</span> <span class="n">spline_estimate_RDP</span><span class="p">,</span> <span class="n">spline_land_RDP</span><span class="p">,</span>
            <span class="n">spline_land_backyard</span><span class="p">,</span> <span class="n">spline_land_informal</span><span class="p">,</span>
            <span class="n">spline_land_constraints</span><span class="p">,</span> <span class="n">number_properties_RDP</span><span class="p">)</span></div>


<div class="viewcode-block" id="import_coeff_land"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_coeff_land">[docs]</a><span class="k">def</span> <span class="nf">import_coeff_land</span><span class="p">(</span><span class="n">spline_land_constraints</span><span class="p">,</span> <span class="n">spline_land_backyard</span><span class="p">,</span>
                      <span class="n">spline_land_informal</span><span class="p">,</span> <span class="n">spline_land_RDP</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return pixel share for housing scenarios, weighted by max building %.&quot;&quot;&quot;</span>
    <span class="c1"># TODO: do we consider area actually used for commercial purposes</span>
    <span class="c1"># as &quot;available&quot; for residential construction?</span>
    <span class="n">coeff_land_private</span> <span class="o">=</span> <span class="p">(</span><span class="n">spline_land_constraints</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                          <span class="o">-</span> <span class="n">spline_land_backyard</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                          <span class="o">-</span> <span class="n">spline_land_informal</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                          <span class="o">-</span> <span class="n">spline_land_RDP</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;max_land_use&quot;</span><span class="p">]</span>
    <span class="n">coeff_land_private</span><span class="p">[</span><span class="n">coeff_land_private</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">coeff_land_backyard</span> <span class="o">=</span> <span class="p">(</span><span class="n">spline_land_backyard</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                           <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;max_land_use_backyard&quot;</span><span class="p">])</span>
    <span class="n">coeff_land_RDP</span> <span class="o">=</span> <span class="n">spline_land_RDP</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># * param[&quot;max_land_use&quot;]</span>
    <span class="n">coeff_land_settlement</span> <span class="o">=</span> <span class="p">(</span><span class="n">spline_land_informal</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                             <span class="o">*</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;max_land_use_settlement&quot;</span><span class="p">])</span>
    <span class="n">coeff_land</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">coeff_land_private</span><span class="p">,</span> <span class="n">coeff_land_backyard</span><span class="p">,</span>
                           <span class="n">coeff_land_settlement</span><span class="p">,</span> <span class="n">coeff_land_RDP</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">coeff_land</span></div>


<div class="viewcode-block" id="import_housing_limit"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_housing_limit">[docs]</a><span class="k">def</span> <span class="nf">import_housing_limit</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return height limit within and out of historic city radius.&quot;&quot;&quot;</span>
    <span class="n">center_regulation</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;historic_radius&quot;</span><span class="p">])</span>
    <span class="n">outside_regulation</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;historic_radius&quot;</span><span class="p">])</span>
    <span class="c1"># We get the maximum amount of housing we can get per kmÂ² (hence the</span>
    <span class="c1"># multiplier as pixel area is given in mÂ²)</span>
    <span class="n">housing_limit</span> <span class="o">=</span> <span class="mi">1000000</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">param</span><span class="p">[</span><span class="s2">&quot;limit_height_center&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">center_regulation</span>
        <span class="o">+</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;limit_height_out&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">outside_regulation</span>
                     <span class="p">)</span>

    <span class="k">return</span> <span class="n">housing_limit</span></div>


<div class="viewcode-block" id="import_init_floods_data"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_init_floods_data">[docs]</a><span class="k">def</span> <span class="nf">import_init_floods_data</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import initial floods data and damage functions.&quot;&quot;&quot;</span>
    <span class="c1"># Import floods data</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;defended&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fluvial_floods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FD_5yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FD_10yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FD_20yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FD_50yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FD_75yr&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;FD_100yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FD_200yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FD_250yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FD_500yr&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;FD_1000yr&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;defended&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">fluvial_floods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FU_5yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_10yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_20yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_50yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_75yr&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;FU_100yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_200yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_250yr&#39;</span><span class="p">,</span> <span class="s1">&#39;FU_500yr&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;FU_1000yr&#39;</span><span class="p">]</span>
    <span class="n">pluvial_floods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;P_5yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_10yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_20yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_50yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_75yr&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;P_100yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_200yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_250yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_500yr&#39;</span><span class="p">,</span> <span class="s1">&#39;P_1000yr&#39;</span><span class="p">]</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;C_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;slr&quot;</span><span class="p">])</span>

    <span class="c1"># Coastal flood maps are extracted from DELTARES global flood maps that</span>
    <span class="c1"># use GTSMip6 water levels as inputs (Muis et al., 2020) for three distinct</span>
    <span class="c1"># DEMs. We only consider the two of them that have a fine resolution of</span>
    <span class="c1"># 90m / 3&#39;&#39; on a par with FATHOM DATA</span>

    <span class="n">coastal_floods</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0000&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0002&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0005&#39;</span><span class="p">,</span>
                      <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0010&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0025&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0050&#39;</span><span class="p">,</span>
                      <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0100&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0250&#39;</span><span class="p">]</span>

    <span class="n">path_data</span> <span class="o">=</span> <span class="n">path_folder</span> <span class="o">+</span> <span class="s2">&quot;FATHOM/&quot;</span>

    <span class="n">d_pluvial</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">d_fluvial</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">d_coastal</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">flood</span> <span class="ow">in</span> <span class="n">fluvial_floods</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">flood</span><span class="p">)</span>
        <span class="n">d_fluvial</span><span class="p">[</span><span class="n">flood</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_data</span> <span class="o">+</span> <span class="n">flood</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">for</span> <span class="n">flood</span> <span class="ow">in</span> <span class="n">pluvial_floods</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">flood</span><span class="p">)</span>
        <span class="n">d_pluvial</span><span class="p">[</span><span class="n">flood</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_data</span> <span class="o">+</span> <span class="n">flood</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">for</span> <span class="n">flood</span> <span class="ow">in</span> <span class="n">coastal_floods</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">flood</span><span class="p">)</span>
        <span class="n">d_coastal</span><span class="p">[</span><span class="n">flood</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_data</span> <span class="o">+</span> <span class="n">flood</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># Damage functions give damage as a % of good considered, as a function</span>
    <span class="c1"># of flood depth in meters</span>

    <span class="c1"># Depth-damage functions (from de Villiers, 2007: ratios from table 3, and</span>
    <span class="c1"># table 4)</span>
    <span class="n">structural_damages_small_houses</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0479</span><span class="p">,</span> <span class="mf">0.1317</span><span class="p">,</span> <span class="mf">0.1795</span><span class="p">,</span> <span class="mf">0.3591</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">structural_damages_medium_houses</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0830</span><span class="p">,</span> <span class="mf">0.2273</span><span class="p">,</span> <span class="mf">0.3083</span><span class="p">,</span> <span class="mf">0.6166</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">structural_damages_large_houses</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0799</span><span class="p">,</span> <span class="mf">0.2198</span><span class="p">,</span> <span class="mf">0.2997</span><span class="p">,</span> <span class="mf">0.5994</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">content_damages</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.77</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># Depth-damage functions (from Englhardt, 2019: figure 2)</span>
    <span class="n">structural_damages_type1</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">structural_damages_type2</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">structural_damages_type3a</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">structural_damages_type3b</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">structural_damages_type4a</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">structural_damages_type4b</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">,</span> <span class="mf">0.64</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># If WBUS2 is used, we take the max from the two sources to be conservative</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;WBUS2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">WBUS2_20yr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
            <span class="n">path_folder</span> <span class="o">+</span> <span class="s2">&quot;Flood plains - from Claus/WBUS2_20yr.xlsx&quot;</span><span class="p">)</span>
        <span class="n">WBUS2_50yr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
            <span class="n">path_folder</span> <span class="o">+</span> <span class="s2">&quot;Flood plains - from Claus/WBUS2_50yr.xlsx&quot;</span><span class="p">)</span>
        <span class="n">WBUS2_100yr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
            <span class="n">path_folder</span> <span class="o">+</span> <span class="s2">&quot;Flood plains - from Claus/WBUS2_100yr.xlsx&quot;</span><span class="p">)</span>
        <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_20yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span>
            <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_20yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span><span class="p">,</span> <span class="n">WBUS2_20yr</span><span class="o">.</span><span class="n">prop_flood_prone</span><span class="p">)</span>
        <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_50yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span>
            <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_50yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span><span class="p">,</span> <span class="n">WBUS2_50yr</span><span class="o">.</span><span class="n">prop_flood_prone</span><span class="p">)</span>
        <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_100yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span>
            <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_100yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span><span class="p">,</span>
            <span class="n">WBUS2_100yr</span><span class="o">.</span><span class="n">prop_flood_prone</span><span class="p">)</span>
        <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_20yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span>
            <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_20yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;depth_WBUS2_20yr&quot;</span><span class="p">])</span>
        <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_50yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span>
            <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_50yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;depth_WBUS2_50yr&quot;</span><span class="p">])</span>
        <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_100yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span>
            <span class="n">d_fluvial</span><span class="p">[</span><span class="s1">&#39;FD_100yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;depth_WBUS2_100yr&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">structural_damages_small_houses</span><span class="p">,</span> <span class="n">structural_damages_medium_houses</span><span class="p">,</span>
            <span class="n">structural_damages_large_houses</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span>
            <span class="n">structural_damages_type1</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span>
            <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span>
            <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span>
            <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">d_pluvial</span><span class="p">,</span> <span class="n">d_coastal</span><span class="p">)</span></div>


<div class="viewcode-block" id="compute_fraction_capital_destroyed"><a class="viewcode-back" href="../../api_ref.html#inputs.data.compute_fraction_capital_destroyed">[docs]</a><span class="k">def</span> <span class="nf">compute_fraction_capital_destroyed</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">type_flood</span><span class="p">,</span> <span class="n">damage_function</span><span class="p">,</span>
                                       <span class="n">housing_type</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Define function used to get fraction of capital destroyed by floods.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">type_flood</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span> <span class="ow">or</span> <span class="n">type_flood</span> <span class="o">==</span> <span class="s1">&#39;FD&#39;</span> <span class="ow">or</span> <span class="n">type_flood</span> <span class="o">==</span> <span class="s1">&#39;FU&#39;</span><span class="p">:</span>
        <span class="c1"># This defines a probability rule (summing to 1) for each time interval</span>
        <span class="c1"># defined in FATHOM (the more distant, the less likely)</span>
        <span class="n">interval0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">interval1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">interval2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">interval3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">interval4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">50</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">75</span><span class="p">)</span>
        <span class="n">interval5</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">75</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">interval6</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">interval7</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">200</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">250</span><span class="p">)</span>
        <span class="n">interval8</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">250</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">500</span><span class="p">)</span>
        <span class="n">interval9</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">500</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">interval10</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>

        <span class="c1"># We consider that formal housing is not vulnerable to pluvial floods</span>
        <span class="c1"># over medium run, and that RDP and backyard are not over short run.</span>
        <span class="c1"># This is based on CCT Minimum Standards for Stormwater Design 2014</span>
        <span class="c1"># (p.37) and Govender 2011 (fig.8 and p.30)</span>
        <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;correct_pluvial&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">type_flood</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">housing_type</span> <span class="o">==</span> <span class="s1">&#39;formal&#39;</span><span class="p">)):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_5yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_10yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_20yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_5yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_10yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_20yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">((</span><span class="n">type_flood</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
                  <span class="o">&amp;</span> <span class="p">((</span><span class="n">housing_type</span> <span class="o">==</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">)</span>
                     <span class="o">|</span> <span class="p">(</span><span class="n">housing_type</span> <span class="o">==</span> <span class="s1">&#39;backyard&#39;</span><span class="p">))):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_5yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_10yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_5yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_10yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">24014</span><span class="p">)</span>

        <span class="c1"># Damage scenarios are incremented using damage functions multiplied by</span>
        <span class="c1"># flood-prone area (yields pixel share of destructed area), so as to</span>
        <span class="c1"># define damage intervals to be used in final computation</span>

        <span class="c1"># TODO: should we take zero value at t = 0?</span>
        <span class="c1"># TODO: is continuous time risk the right framework?</span>
        <span class="n">damages0</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_5yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                    <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_5yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
        <span class="c1"># damages0 = (</span>
        <span class="c1">#     d[type_flood + &#39;_5yr&#39;].prop_flood_prone</span>
        <span class="c1">#     * damage_function(d[type_flood + &#39;_5yr&#39;].flood_depth)</span>
        <span class="c1">#     + d[type_flood + &#39;_5yr&#39;].prop_flood_prone</span>
        <span class="c1">#     * damage_function(d[type_flood + &#39;_10yr&#39;].flood_depth)</span>
        <span class="c1">#     )</span>
        <span class="n">damages1</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_5yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_5yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_10yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_10yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages2</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_10yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_10yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_20yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_20yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages3</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_20yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_20yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_50yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_50yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages4</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_50yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_50yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_75yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_75yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages5</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_75yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_75yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_100yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_100yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="p">)</span>
        <span class="n">damages6</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_100yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_100yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_200yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_200yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="p">)</span>
        <span class="n">damages7</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_200yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_200yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_250yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_250yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="p">)</span>
        <span class="n">damages8</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_250yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_250yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_500yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_500yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="p">)</span>
        <span class="n">damages9</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_500yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_500yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_1000yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_1000yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)</span>
                       <span class="p">))</span>
        <span class="c1"># We assume that value stays the same when t = +inf</span>
        <span class="n">damages10</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_1000yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                      <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_1000yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                     <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_1000yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                        <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_1000yr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span>
                                          <span class="p">)))</span>

        <span class="c1"># The formula for expected fraction of capital destroyed is given by</span>
        <span class="c1"># the integral of damage according to time (or rather, inverse</span>
        <span class="c1"># probability).</span>
        <span class="c1"># Assuming that damages increase linearly with time (or inverse</span>
        <span class="c1"># probability), we can approximate this area as a sum of rectangles</span>
        <span class="c1"># defined for each of our intervals: this yields the following formula</span>

        <span class="c1"># NB: for more graphical intuition, see</span>
        <span class="c1"># https://storymaps.arcgis.com/stories/7878c89c592e4a78b45f03b4b696ccac</span>

        <span class="k">return</span> <span class="p">(</span><span class="mf">0.5</span>
                <span class="o">*</span> <span class="p">((</span><span class="n">interval0</span> <span class="o">*</span> <span class="n">damages0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval1</span> <span class="o">*</span> <span class="n">damages1</span><span class="p">)</span>
                   <span class="o">+</span> <span class="p">(</span><span class="n">interval2</span> <span class="o">*</span> <span class="n">damages2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval3</span> <span class="o">*</span> <span class="n">damages3</span><span class="p">)</span>
                   <span class="o">+</span> <span class="p">(</span><span class="n">interval4</span> <span class="o">*</span> <span class="n">damages4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval5</span> <span class="o">*</span> <span class="n">damages5</span><span class="p">)</span>
                   <span class="o">+</span> <span class="p">(</span><span class="n">interval6</span> <span class="o">*</span> <span class="n">damages6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval7</span> <span class="o">*</span> <span class="n">damages7</span><span class="p">)</span>
                   <span class="o">+</span> <span class="p">(</span><span class="n">interval8</span> <span class="o">*</span> <span class="n">damages8</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval9</span> <span class="o">*</span> <span class="n">damages9</span><span class="p">)</span>
                   <span class="o">+</span> <span class="p">(</span><span class="n">interval10</span> <span class="o">*</span> <span class="n">damages10</span><span class="p">)))</span>

    <span class="k">elif</span> <span class="n">type_flood</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
        <span class="n">interval0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">interval1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">interval2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">interval3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">interval4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">25</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">interval5</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">50</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">interval6</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">250</span><span class="p">)</span>
        <span class="n">interval7</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">250</span><span class="p">)</span>
    <span class="c1"># NB: note that we do not use the same intervals for coastal as for</span>
    <span class="c1"># pluvial/fluvial since we do not have the same return periods available</span>
    <span class="c1"># in Deltares and FATHOM data</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">type_flood</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;slr&quot;</span><span class="p">])</span>
        <span class="n">damages0</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0000&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0000&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0002&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0002&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages1</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0002&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0002&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0005&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0005&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages2</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0005&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0005&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages3</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0010&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0025&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0025&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages4</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0025&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0025&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0050&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0050&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages5</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0050&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0050&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0100&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0100&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages6</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0100&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0100&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0250&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0250&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>
        <span class="n">damages7</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0250&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                     <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0250&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">))</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0250&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">prop_flood_prone</span>
                       <span class="o">*</span> <span class="n">damage_function</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_0250&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)))</span>

        <span class="k">return</span> <span class="p">(</span><span class="mf">0.5</span>
                <span class="o">*</span> <span class="p">((</span><span class="n">interval0</span> <span class="o">*</span> <span class="n">damages0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval1</span> <span class="o">*</span> <span class="n">damages1</span><span class="p">)</span>
                   <span class="o">+</span> <span class="p">(</span><span class="n">interval2</span> <span class="o">*</span> <span class="n">damages2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval3</span> <span class="o">*</span> <span class="n">damages3</span><span class="p">)</span>
                   <span class="o">+</span> <span class="p">(</span><span class="n">interval4</span> <span class="o">*</span> <span class="n">damages4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval5</span> <span class="o">*</span> <span class="n">damages5</span><span class="p">)</span>
                   <span class="o">+</span> <span class="p">(</span><span class="n">interval6</span> <span class="o">*</span> <span class="n">damages6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">interval7</span> <span class="o">*</span> <span class="n">damages7</span><span class="p">)))</span></div>


<div class="viewcode-block" id="import_full_floods_data"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_full_floods_data">[docs]</a><span class="k">def</span> <span class="nf">import_full_floods_data</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">housing_type_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add fraction of capital destroyed by floods to initial floods data.&quot;&quot;&quot;</span>
    <span class="n">fraction_capital_destroyed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="p">(</span><span class="n">structural_damages_small_houses</span><span class="p">,</span> <span class="n">structural_damages_medium_houses</span><span class="p">,</span>
     <span class="n">structural_damages_large_houses</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span>
     <span class="n">structural_damages_type1</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span>
     <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span>
     <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span>
     <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">d_pluvial</span><span class="p">,</span> <span class="n">d_coastal</span><span class="p">)</span> <span class="o">=</span> <span class="n">import_init_floods_data</span><span class="p">(</span>
         <span class="n">options</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;defended&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fluvialtype</span> <span class="o">=</span> <span class="s1">&#39;FD&#39;</span>
    <span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;defended&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">fluvialtype</span> <span class="o">=</span> <span class="s1">&#39;FU&#39;</span>

    <span class="c1"># TODO: Define as maximum!</span>

    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;pluvial&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;coastal&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in private formal&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_formal&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in informal settlements&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_informal&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in (any) backyard&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_backyard&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in formal subsidized&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_subsidized&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private formal structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_1&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private formal structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_2&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal subsidized structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_subsidized_1&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal subsidized structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_subsidized_2&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Informal settlement structures&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_settlements&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Informal backyard structures&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal backyard structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal backyard structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;pluvial&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;coastal&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in private formal&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_formal&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in informal settlements&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_informal&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in (any) backyard&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_backyard&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in formal subsidized&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_subsidized&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private formal structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_1&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private formal structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_2&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal subsidized structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_subsidized_1&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal subsidized structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_subsidized_2&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Informal settlement structures&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_settlements&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Informal backyard structures&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal backyard structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal backyard structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;pluvial&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;coastal&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in private formal&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_formal&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in informal settlements&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_informal&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in (any) backyard&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_backyard&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in formal subsidized&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_subsidized&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private formal structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_1&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private formal structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_2&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal subsidized structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_subsidized_1&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal subsidized structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_subsidized_2&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Informal settlement structures&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_settlements&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Informal backyard structures&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal backyard structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal backyard structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;pluvial&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;coastal&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in private formal&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_formal&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in informal settlements&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_informal&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in (any) backyard&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_backyard&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Contents in formal subsidized&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;contents_subsidized&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">content_damages</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private formal structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_1&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private formal structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_2&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;formal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal subsidized structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_subsidized_1&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal subsidized structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_subsidized_2&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type4b</span><span class="p">,</span> <span class="s1">&#39;subsidized&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Informal settlement structures&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_settlements&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;informal&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Informal backyard structures&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal backyard structures (one floor)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal backyard structures (two floors)&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_backyards&quot;</span><span class="p">]</span>
         <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
             <span class="n">d_fluvial</span><span class="p">,</span> <span class="n">fluvialtype</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_coastal</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">compute_fraction_capital_destroyed</span><span class="p">(</span>
                 <span class="n">d_pluvial</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">structural_damages_type3b</span><span class="p">,</span> <span class="s1">&#39;backyard&#39;</span><span class="p">,</span>
                 <span class="n">options</span><span class="p">))</span>

    <span class="c1"># We take a weighted average for structures in bricks and shacks among</span>
    <span class="c1"># all backyard structures in case we include both in the model.</span>
    <span class="c1"># To do so, we rely on SAL-level housing type data.</span>

    <span class="n">sal_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">path_folder</span>
        <span class="o">+</span> <span class="s2">&quot;CT Dwelling type data validation workbook 20201204 v2.xlsx&quot;</span><span class="p">,</span>
        <span class="n">header</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">5339</span><span class="p">)</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_formal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;House/flat/room in backyard&quot;</span><span class="p">]</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_informal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span>
        <span class="s2">&quot;Informal dwelling (shack; in backyard)&quot;</span><span class="p">]</span>
    <span class="n">total_backyard_formal</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_formal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">total_backyard_informal</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_informal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_backyards&quot;</span><span class="p">]</span>
     <span class="p">)</span> <span class="o">=</span> <span class="p">((</span><span class="n">total_backyard_formal</span>
           <span class="o">*</span> <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_formal_backyards&quot;</span><span class="p">])</span>
          <span class="o">+</span> <span class="p">(</span><span class="n">total_backyard_informal</span>
              <span class="o">*</span> <span class="n">fraction_capital_destroyed</span><span class="p">[</span><span class="s2">&quot;structure_informal_backyards&quot;</span><span class="p">])</span>
          <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">total_backyard_formal</span> <span class="o">+</span> <span class="n">total_backyard_informal</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">fraction_capital_destroyed</span><span class="p">,</span> <span class="n">structural_damages_small_houses</span><span class="p">,</span>
            <span class="n">structural_damages_medium_houses</span><span class="p">,</span> <span class="n">structural_damages_large_houses</span><span class="p">,</span>
            <span class="n">content_damages</span><span class="p">,</span> <span class="n">structural_damages_type1</span><span class="p">,</span>
            <span class="n">structural_damages_type2</span><span class="p">,</span> <span class="n">structural_damages_type3a</span><span class="p">,</span>
            <span class="n">structural_damages_type3b</span><span class="p">,</span> <span class="n">structural_damages_type4a</span><span class="p">,</span>
            <span class="n">structural_damages_type4b</span><span class="p">)</span></div>


<div class="viewcode-block" id="infer_WBUS2_depth"><a class="viewcode-back" href="../../api_ref.html#inputs.data.infer_WBUS2_depth">[docs]</a><span class="k">def</span> <span class="nf">infer_WBUS2_depth</span><span class="p">(</span><span class="n">housing_types</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">path_floods</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update CoCT flood data with FATHOM flood depth (deprecated).&quot;&quot;&quot;</span>
    <span class="n">FATHOM_20yr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_floods</span> <span class="o">+</span> <span class="s1">&#39;FD_20yr&#39;</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">))</span>
    <span class="n">FATHOM_50yr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_floods</span> <span class="o">+</span> <span class="s1">&#39;FD_50yr&#39;</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">))</span>
    <span class="n">FATHOM_100yr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">path_floods</span> <span class="o">+</span> <span class="s1">&#39;FD_100yr&#39;</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">))</span>

    <span class="n">FATHOM_20yr</span><span class="p">[</span><span class="s1">&#39;pop_flood_prone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">FATHOM_20yr</span><span class="o">.</span><span class="n">prop_flood_prone</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">housing_types</span><span class="o">.</span><span class="n">informal_grid</span>
           <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">formal_grid</span>
           <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">backyard_formal_grid</span>
           <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">backyard_informal_grid</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">FATHOM_50yr</span><span class="p">[</span><span class="s1">&#39;pop_flood_prone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">FATHOM_50yr</span><span class="o">.</span><span class="n">prop_flood_prone</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">housing_types</span><span class="o">.</span><span class="n">informal_grid</span>
           <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">formal_grid</span>
           <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">backyard_formal_grid</span>
           <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">backyard_informal_grid</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">FATHOM_100yr</span><span class="p">[</span><span class="s1">&#39;pop_flood_prone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">FATHOM_100yr</span><span class="o">.</span><span class="n">prop_flood_prone</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">housing_types</span><span class="o">.</span><span class="n">informal_grid</span>
           <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">formal_grid</span>
           <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">backyard_formal_grid</span>
           <span class="o">+</span> <span class="n">housing_types</span><span class="o">.</span><span class="n">backyard_informal_grid</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">param</span><span class="p">[</span><span class="s2">&quot;depth_WBUS2_20yr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
        <span class="n">FATHOM_20yr</span><span class="o">.</span><span class="n">pop_flood_prone</span> <span class="o">*</span> <span class="n">FATHOM_20yr</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">FATHOM_20yr</span><span class="o">.</span><span class="n">pop_flood_prone</span><span class="p">))</span>
    <span class="n">param</span><span class="p">[</span><span class="s2">&quot;depth_WBUS2_50yr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
        <span class="n">FATHOM_50yr</span><span class="o">.</span><span class="n">pop_flood_prone</span> <span class="o">*</span> <span class="n">FATHOM_50yr</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">FATHOM_50yr</span><span class="o">.</span><span class="n">pop_flood_prone</span><span class="p">))</span>
    <span class="n">param</span><span class="p">[</span><span class="s2">&quot;depth_WBUS2_100yr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
        <span class="n">FATHOM_100yr</span><span class="o">.</span><span class="n">pop_flood_prone</span> <span class="o">*</span> <span class="n">FATHOM_100yr</span><span class="o">.</span><span class="n">flood_depth</span><span class="p">)</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">FATHOM_100yr</span><span class="o">.</span><span class="n">pop_flood_prone</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">param</span></div>


<div class="viewcode-block" id="import_transport_data"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_transport_data">[docs]</a><span class="k">def</span> <span class="nf">import_transport_data</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">yearTraffic</span><span class="p">,</span>
                          <span class="n">households_per_income_class</span><span class="p">,</span> <span class="n">average_income</span><span class="p">,</span>
                          <span class="n">spline_inflation</span><span class="p">,</span>
                          <span class="n">spline_fuel</span><span class="p">,</span>
                          <span class="n">spline_population_income_distribution</span><span class="p">,</span>
                          <span class="n">spline_income_distribution</span><span class="p">,</span>
                          <span class="n">path_precalc_inp</span><span class="p">,</span> <span class="n">path_precalc_transp</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute job center distribution, commuting and net income.&quot;&quot;&quot;</span>
    <span class="c1"># Import (monetary and time) transport costs</span>
    <span class="p">(</span><span class="n">timeOutput</span><span class="p">,</span> <span class="n">distanceOutput</span><span class="p">,</span> <span class="n">monetaryCost</span><span class="p">,</span> <span class="n">costTime</span>
     <span class="p">)</span> <span class="o">=</span> <span class="n">calcmp</span><span class="o">.</span><span class="n">import_transport_costs</span><span class="p">(</span>
         <span class="n">grid</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">yearTraffic</span><span class="p">,</span> <span class="n">households_per_income_class</span><span class="p">,</span>
         <span class="n">spline_inflation</span><span class="p">,</span> <span class="n">spline_fuel</span><span class="p">,</span> <span class="n">spline_population_income_distribution</span><span class="p">,</span>
         <span class="n">spline_income_distribution</span><span class="p">,</span> <span class="n">path_precalc_inp</span><span class="p">,</span> <span class="n">path_precalc_transp</span><span class="p">,</span>
         <span class="n">dim</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="n">param_lambda</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;lambda&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="n">incomeNetOfCommuting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">],</span>
         <span class="n">timeOutput</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>
    <span class="n">averageIncome</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">],</span>
         <span class="n">timeOutput</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>
    <span class="n">modalShares</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">(</span><span class="mi">185</span><span class="p">,</span> <span class="n">timeOutput</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span>
         <span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">])</span>
        <span class="p">)</span>
    <span class="n">ODflows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">(</span><span class="mi">185</span><span class="p">,</span> <span class="n">timeOutput</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
         <span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="c1"># Update average income and number of households per income group</span>
    <span class="c1"># for considered year</span>
    <span class="n">incomeGroup</span><span class="p">,</span> <span class="n">households_per_income_class</span> <span class="o">=</span> <span class="n">eqdyn</span><span class="o">.</span><span class="n">compute_average_income</span><span class="p">(</span>
        <span class="n">spline_population_income_distribution</span><span class="p">,</span> <span class="n">spline_income_distribution</span><span class="p">,</span>
        <span class="n">param</span><span class="p">,</span> <span class="n">yearTraffic</span><span class="p">)</span>

    <span class="c1"># We import expected income associated with each income center and income</span>
    <span class="c1"># group (from calibration)</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;load_precal_param&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">income_centers_init</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span>
            <span class="n">path_precalc_inp</span> <span class="o">+</span> <span class="s1">&#39;incomeCentersKeep.mat&#39;</span><span class="p">)[</span><span class="s1">&#39;incomeCentersKeep&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;load_precal_param&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">income_centers_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="n">path_precalc_inp</span> <span class="o">+</span> <span class="s1">&#39;incomeCentersKeep.npy&#39;</span><span class="p">)</span>
    <span class="c1"># This allows to correct incomes for unemployed population not taken into</span>
    <span class="c1"># account in initial income data (just in scenarios)</span>
    <span class="n">incomeCenters</span> <span class="o">=</span> <span class="n">income_centers_init</span> <span class="o">*</span> <span class="n">incomeGroup</span> <span class="o">/</span> <span class="n">average_income</span>

    <span class="c1"># Switch to hourly</span>
    <span class="n">annualToHourly</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="mi">20</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">monetaryCost</span> <span class="o">=</span> <span class="n">monetaryCost</span> <span class="o">*</span> <span class="n">annualToHourly</span>
    <span class="n">incomeCenters</span> <span class="o">=</span> <span class="n">incomeCenters</span> <span class="o">*</span> <span class="n">annualToHourly</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;nb_of_income_classes&quot;</span><span class="p">]):</span>

        <span class="c1"># Household size varies with income group / transport costs</span>
        <span class="n">householdSize</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;household_size&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="c1"># Here, -100000 corresponds to an arbitrary value given to incomes in</span>
        <span class="c1"># centers with too few jobs to have convergence in calibration (could</span>
        <span class="c1"># have been nan): we exclude those centers from the analysis</span>
        <span class="n">whichCenters</span> <span class="o">=</span> <span class="n">incomeCenters</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">100000</span>
        <span class="n">incomeCentersGroup</span> <span class="o">=</span> <span class="n">incomeCenters</span><span class="p">[</span><span class="n">whichCenters</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

        <span class="c1"># We compute transport costs for each mode and per chosen mode</span>
        <span class="c1"># (cost per hour)</span>

        <span class="p">(</span><span class="n">transportCostModes</span><span class="p">,</span> <span class="n">transportCost</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">valueMax</span><span class="p">,</span> <span class="n">minIncome</span>
         <span class="p">)</span> <span class="o">=</span> <span class="n">calcmp</span><span class="o">.</span><span class="n">compute_ODflows</span><span class="p">(</span>
            <span class="n">householdSize</span><span class="p">,</span> <span class="n">monetaryCost</span><span class="p">,</span> <span class="n">costTime</span><span class="p">,</span> <span class="n">incomeCentersGroup</span><span class="p">,</span>
            <span class="n">whichCenters</span><span class="p">,</span> <span class="n">param_lambda</span><span class="p">)</span>

        <span class="c1"># NB: we compute OD flows again later to get the full matrix</span>

        <span class="c1"># Modal shares</span>
        <span class="c1"># This comes from the multinomial model resulting from extreme value</span>
        <span class="c1"># theory with a Gumbel distribution (generalized EV type-I)</span>
        <span class="c1"># NB: here, we consider minimum Gumbel</span>
        <span class="n">modalShares</span><span class="p">[</span><span class="n">whichCenters</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span> <span class="n">param_lambda</span> <span class="o">*</span> <span class="n">transportCostModes</span> <span class="o">+</span> <span class="n">valueMax</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])</span>
            <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="n">param_lambda</span> <span class="o">*</span> <span class="n">transportCostModes</span>
                               <span class="o">+</span> <span class="n">valueMax</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># OD flows: corresponds to pi_c|ix (we redefine it as a full matrix)</span>
        <span class="c1"># NB: here, we consider maximum Gumbel</span>
        <span class="n">ODflows</span><span class="p">[</span><span class="n">whichCenters</span><span class="p">,</span> <span class="p">:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">param_lambda</span> <span class="o">*</span> <span class="p">(</span><span class="n">incomeCentersGroup</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">transportCost</span><span class="p">)</span>
                   <span class="o">-</span> <span class="n">minIncome</span><span class="p">)</span>
            <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">param_lambda</span> <span class="o">*</span> <span class="p">(</span><span class="n">incomeCentersGroup</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
                                               <span class="o">-</span> <span class="n">transportCost</span><span class="p">)</span> <span class="o">-</span> <span class="n">minIncome</span><span class="p">),</span>
                        <span class="mi">0</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
            <span class="p">)</span>

        <span class="c1"># Expected income net of commuting costs (correct formula): cf. log-sum</span>
        <span class="c1"># calculation ans selection bias with weighted sum and error terms</span>
        <span class="c1"># NB: here, we consider maximum Gumbel</span>
        <span class="n">incomeNetOfCommuting</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">1</span><span class="o">/</span><span class="n">param_lambda</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                <span class="n">param_lambda</span> <span class="o">*</span> <span class="p">(</span><span class="n">incomeCentersGroup</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">transportCost</span><span class="p">)</span>
                <span class="o">-</span> <span class="n">minIncome</span><span class="p">),</span>
                <span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="n">minIncome</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Average income (not net of commuting costs) earned per worker</span>
        <span class="c1"># NB: here, we just take the weighted average as there is no error</span>
        <span class="c1"># Note that this should take unemployment into account</span>
        <span class="n">averageIncome</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
            <span class="n">ODflows</span><span class="p">[</span><span class="n">whichCenters</span><span class="p">,</span> <span class="p">:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">incomeCentersGroup</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># We go back to yearly format before saving results</span>
    <span class="n">incomeNetOfCommuting</span> <span class="o">=</span> <span class="n">incomeNetOfCommuting</span> <span class="o">/</span> <span class="n">annualToHourly</span>
    <span class="n">averageIncome</span> <span class="o">=</span> <span class="n">averageIncome</span> <span class="o">/</span> <span class="n">annualToHourly</span>

    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_precalc_transp</span> <span class="o">+</span> <span class="n">dim</span> <span class="o">+</span> <span class="s2">&quot;_averageIncome_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">yearTraffic</span><span class="p">),</span>
            <span class="n">averageIncome</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_precalc_transp</span> <span class="o">+</span> <span class="n">dim</span> <span class="o">+</span> <span class="s2">&quot;_incomeNetOfCommuting_&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">yearTraffic</span><span class="p">),</span> <span class="n">incomeNetOfCommuting</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_precalc_transp</span> <span class="o">+</span> <span class="n">dim</span> <span class="o">+</span> <span class="s2">&quot;_modalShares_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">yearTraffic</span><span class="p">),</span>
            <span class="n">modalShares</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_precalc_transp</span> <span class="o">+</span> <span class="n">dim</span> <span class="o">+</span> <span class="s2">&quot;_ODflows_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">yearTraffic</span><span class="p">),</span>
            <span class="n">ODflows</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">incomeNetOfCommuting</span><span class="p">,</span> <span class="n">modalShares</span><span class="p">,</span> <span class="n">ODflows</span><span class="p">,</span> <span class="n">averageIncome</span></div>


<div class="viewcode-block" id="import_sal_data"><a class="viewcode-back" href="../../api_ref.html#inputs.data.import_sal_data">[docs]</a><span class="k">def</span> <span class="nf">import_sal_data</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span> <span class="n">housing_type_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import SAL data for population density by housing type.&quot;&quot;&quot;</span>
    <span class="n">sal_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">path_folder</span>
        <span class="o">+</span> <span class="s2">&quot;CT Dwelling type data validation workbook 20201204 v2.xlsx&quot;</span><span class="p">,</span>
        <span class="n">header</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">5339</span><span class="p">)</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;informal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span>
        <span class="s2">&quot;Informal dwelling (shack; not in backyard; e.g. in an&quot;</span>
        <span class="o">+</span> <span class="s2">&quot; informal/squatter settlement or on a farm)&quot;</span><span class="p">]</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_formal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;House/flat/room in backyard&quot;</span><span class="p">]</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_informal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span>
        <span class="s2">&quot;Informal dwelling (shack; in backyard)&quot;</span><span class="p">]</span>
    <span class="c1"># NB: we do not include traditional houses, granny flats, caravans, and</span>
    <span class="c1"># others</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;formal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">sal_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">sal_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">path_folder</span>
        <span class="o">+</span> <span class="s2">&quot;CT Dwelling type data validation workbook 20201204 v2.xlsx&quot;</span><span class="p">,</span>
        <span class="n">header</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">5339</span><span class="p">)</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;informal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span>
        <span class="s2">&quot;Informal dwelling (shack; not in backyard; e.g. in an&quot;</span>
        <span class="o">+</span> <span class="s2">&quot; informal/squatter settlement or on a farm)&quot;</span><span class="p">]</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_formal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;House/flat/room in backyard&quot;</span><span class="p">]</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_informal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sal_data</span><span class="p">[</span>
        <span class="s2">&quot;Informal dwelling (shack; in backyard)&quot;</span><span class="p">]</span>
    <span class="c1"># NB: we do not include traditional houses, granny flats, caravans, and</span>
    <span class="c1"># others</span>
    <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;formal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">sal_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># We import information on intersection between SAL and grid pixels</span>
    <span class="n">grid_intersect</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_data</span> <span class="o">+</span> <span class="s1">&#39;grid_SAL_intersect.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
    <span class="n">grid_intersect</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Area_inter&quot;</span><span class="p">:</span> <span class="s2">&quot;Area&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># We then proceed to the disaggregation of SAL data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Informal settlements&quot;</span><span class="p">)</span>
    <span class="n">informal_grid</span> <span class="o">=</span> <span class="n">gen_small_areas_to_grid</span><span class="p">(</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">grid_intersect</span><span class="p">,</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;informal&quot;</span><span class="p">],</span>
        <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;Small Area Code&quot;</span><span class="p">],</span> <span class="s1">&#39;SAL&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Formal backyards&quot;</span><span class="p">)</span>
    <span class="n">backyard_formal_grid</span> <span class="o">=</span> <span class="n">gen_small_areas_to_grid</span><span class="p">(</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">grid_intersect</span><span class="p">,</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_formal&quot;</span><span class="p">],</span>
        <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;Small Area Code&quot;</span><span class="p">],</span> <span class="s1">&#39;SAL&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Informal backyards&quot;</span><span class="p">)</span>
    <span class="n">backyard_informal_grid</span> <span class="o">=</span> <span class="n">gen_small_areas_to_grid</span><span class="p">(</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">grid_intersect</span><span class="p">,</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_informal&quot;</span><span class="p">],</span>
        <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;Small Area Code&quot;</span><span class="p">],</span> <span class="s1">&#39;SAL&#39;</span><span class="p">)</span>
    <span class="c1"># NB: this does include RDP</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private formal + subsidized formal housing&quot;</span><span class="p">)</span>
    <span class="n">formal_grid</span> <span class="o">=</span> <span class="n">gen_small_areas_to_grid</span><span class="p">(</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">grid_intersect</span><span class="p">,</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;formal&quot;</span><span class="p">],</span> <span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;Small Area Code&quot;</span><span class="p">],</span>
        <span class="s1">&#39;SAL&#39;</span><span class="p">)</span>

    <span class="c1"># We correct the number of dwellings per pixel by reweighting with the</span>
    <span class="c1"># ratio of total original number over total estimated number</span>
    <span class="c1"># NB: this allows to correct for potential errors or imperfect information</span>
    <span class="c1"># in the matching of small areas and grid pixels</span>
    <span class="n">informal_grid</span> <span class="o">=</span> <span class="p">(</span><span class="n">informal_grid</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;informal&quot;</span><span class="p">])</span>
                                      <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">informal_grid</span><span class="p">)))</span>
    <span class="n">backyard_formal_grid</span> <span class="o">=</span> <span class="p">(</span><span class="n">backyard_formal_grid</span>
                            <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_formal&quot;</span><span class="p">])</span>
                               <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">backyard_formal_grid</span><span class="p">)))</span>
    <span class="n">backyard_informal_grid</span> <span class="o">=</span> <span class="p">(</span><span class="n">backyard_informal_grid</span>
                              <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;backyard_informal&quot;</span><span class="p">])</span>
                                 <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">backyard_informal_grid</span><span class="p">)))</span>
    <span class="n">formal_grid</span> <span class="o">=</span> <span class="p">(</span><span class="n">formal_grid</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">sal_data</span><span class="p">[</span><span class="s2">&quot;formal&quot;</span><span class="p">])</span>
                                  <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">formal_grid</span><span class="p">)))</span>

    <span class="n">housing_types_grid_sal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">housing_types_grid_sal</span><span class="p">[</span><span class="s2">&quot;informal_grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">informal_grid</span>
    <span class="n">housing_types_grid_sal</span><span class="p">[</span><span class="s2">&quot;backyard_formal_grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">backyard_formal_grid</span>
    <span class="n">housing_types_grid_sal</span><span class="p">[</span><span class="s2">&quot;backyard_informal_grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">backyard_informal_grid</span>
    <span class="n">housing_types_grid_sal</span><span class="p">[</span><span class="s2">&quot;formal_grid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formal_grid</span>

    <span class="c1"># Replace missing values by zero</span>
    <span class="n">housing_types_grid_sal</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">housing_types_grid_sal</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">housing_types_grid_sal</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
        <span class="n">path_folder</span> <span class="o">+</span> <span class="s1">&#39;housing_types_grid_sal.xlsx&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">housing_types_grid_sal</span></div>


<div class="viewcode-block" id="gen_small_areas_to_grid"><a class="viewcode-back" href="../../api_ref.html#inputs.data.gen_small_areas_to_grid">[docs]</a><span class="k">def</span> <span class="nf">gen_small_areas_to_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">grid_intersect</span><span class="p">,</span> <span class="n">small_area_data</span><span class="p">,</span>
                            <span class="n">small_area_code</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert SAL/SP to grid dimensions.&quot;&quot;&quot;</span>
    <span class="n">grid_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">dist</span><span class="p">))</span>
    <span class="c1"># We loop over grid pixels</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Looping over pixels&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">dist</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># We define a list of SAL/SP codes that do intersect considered pixel</span>
        <span class="n">intersect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">grid_intersect</span><span class="p">[</span><span class="n">unit</span> <span class="o">+</span> <span class="s1">&#39;_CODE&#39;</span><span class="p">][</span><span class="n">grid_intersect</span><span class="o">.</span><span class="n">ID_grille</span>
                                           <span class="o">==</span> <span class="n">grid</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersect</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">grid_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the intersection is not empty, we loop over intersecting</span>
            <span class="c1"># SAL/SPs</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersect</span><span class="p">)):</span>
                <span class="n">small_code</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># Then, we get the corresponding area for the sub-intersection</span>
                <span class="c1"># and for the overall SAL/SP</span>
                <span class="n">small_area_intersect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                    <span class="n">grid_intersect</span><span class="o">.</span><span class="n">Area</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">grid_intersect</span><span class="o">.</span><span class="n">ID_grille</span> <span class="o">==</span> <span class="n">grid</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">grid_intersect</span><span class="p">[</span><span class="n">unit</span> <span class="o">+</span> <span class="s1">&#39;_CODE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">small_code</span><span class="p">)</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span>
                <span class="n">small_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                    <span class="n">grid_intersect</span><span class="o">.</span><span class="n">Area</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">grid_intersect</span><span class="p">[</span><span class="n">unit</span> <span class="o">+</span> <span class="s1">&#39;_CODE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">small_code</span><span class="p">)]</span>
                    <span class="p">)</span>
                <span class="c1"># If such SAL/SP code does indeed exist in the matching data,</span>
                <span class="c1"># we store a weighted average of the info it contains</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">small_area_data</span><span class="p">[</span>
                        <span class="n">small_area_code</span> <span class="o">==</span> <span class="n">small_code</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># More precisely, this yields the number of</span>
                    <span class="c1"># dwellings/households given by the intersection</span>
                    <span class="n">add</span> <span class="o">=</span> <span class="p">(</span><span class="n">small_area_data</span><span class="p">[</span><span class="n">small_area_code</span> <span class="o">==</span> <span class="n">small_code</span><span class="p">]</span>
                           <span class="o">*</span> <span class="p">(</span><span class="n">small_area_intersect</span> <span class="o">/</span> <span class="n">small_area</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">add</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># Finally, we update our output data with each weighted info</span>
                <span class="c1"># corresponding to each of the SAL/SP intersection with</span>
                <span class="c1"># considered grid pixel</span>
                <span class="n">grid_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">add</span>

    <span class="k">return</span> <span class="n">grid_data</span></div>


<div class="viewcode-block" id="convert_income_distribution"><a class="viewcode-back" href="../../api_ref.html#inputs.data.convert_income_distribution">[docs]</a><span class="k">def</span> <span class="nf">convert_income_distribution</span><span class="p">(</span><span class="n">income_distribution</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span> <span class="n">data_sp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import SP data for income distribution in grid form.&quot;&quot;&quot;</span>
    <span class="n">grid_intersect</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_data</span> <span class="o">+</span> <span class="s1">&#39;grid_SP_intersect.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

    <span class="n">income0_grid</span> <span class="o">=</span> <span class="n">gen_small_areas_to_grid</span><span class="p">(</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">grid_intersect</span><span class="p">,</span> <span class="n">income_distribution</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;sp_code&quot;</span><span class="p">],</span> <span class="s1">&#39;SP&#39;</span><span class="p">)</span>
    <span class="n">income1_grid</span> <span class="o">=</span> <span class="n">gen_small_areas_to_grid</span><span class="p">(</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">grid_intersect</span><span class="p">,</span> <span class="n">income_distribution</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;sp_code&quot;</span><span class="p">],</span> <span class="s1">&#39;SP&#39;</span><span class="p">)</span>
    <span class="n">income2_grid</span> <span class="o">=</span> <span class="n">gen_small_areas_to_grid</span><span class="p">(</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">grid_intersect</span><span class="p">,</span> <span class="n">income_distribution</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;sp_code&quot;</span><span class="p">],</span> <span class="s1">&#39;SP&#39;</span><span class="p">)</span>
    <span class="n">income3_grid</span> <span class="o">=</span> <span class="n">gen_small_areas_to_grid</span><span class="p">(</span>
        <span class="n">grid</span><span class="p">,</span> <span class="n">grid_intersect</span><span class="p">,</span> <span class="n">income_distribution</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="n">data_sp</span><span class="p">[</span><span class="s2">&quot;sp_code&quot;</span><span class="p">],</span> <span class="s1">&#39;SP&#39;</span><span class="p">)</span>

    <span class="c1"># We correct the values per pixel by reweighting with the</span>
    <span class="c1"># ratio of total original number over total estimated number</span>
    <span class="n">income0_grid</span> <span class="o">=</span> <span class="p">(</span><span class="n">income0_grid</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">income_distribution</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
                                    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">income0_grid</span><span class="p">)))</span>
    <span class="n">income1_grid</span> <span class="o">=</span> <span class="p">(</span><span class="n">income1_grid</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">income_distribution</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
                                    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">income1_grid</span><span class="p">)))</span>
    <span class="n">income2_grid</span> <span class="o">=</span> <span class="p">(</span><span class="n">income2_grid</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">income_distribution</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
                                    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">income2_grid</span><span class="p">)))</span>
    <span class="n">income3_grid</span> <span class="o">=</span> <span class="p">(</span><span class="n">income3_grid</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">income_distribution</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span>
                                    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">income3_grid</span><span class="p">)))</span>

    <span class="n">income_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
        <span class="p">[</span><span class="n">income0_grid</span><span class="p">,</span> <span class="n">income1_grid</span><span class="p">,</span> <span class="n">income2_grid</span><span class="p">,</span> <span class="n">income3_grid</span><span class="p">])</span>

    <span class="c1"># Replace missing values by zero</span>
    <span class="n">income_grid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">income_grid</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path_data</span> <span class="o">+</span> <span class="s2">&quot;income_distrib_grid.npy&quot;</span><span class="p">,</span> <span class="n">income_grid</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">income_grid</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Thomas Monnier.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>